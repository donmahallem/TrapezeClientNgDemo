(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ZGAW:function(t,e,s){"use strict";s.r(e);var a=s("ofXK"),i=s("fXoL"),r=s("TY1r"),n=s("kEI4"),o=s("Xlwt"),c=s("J0hL"),u=s("G/Ji"),l=s("0DDv"),p=s("2Vo4"),b=s("itXk"),h=s("PqYM"),g=s("7o/Q"),d=s("lJxs"),f=s("/uUt");let m=(()=>{class t{constructor(){this.placeholder="-",this.timestamp="",this.timestampSubject=new p.a(0)}set targetTime(t){this.timestampSubject.next(t)}get text(){return this.timestamp}ngOnInit(){this.updateSubscription=Object(b.a)([Object(h.a)(0,200),this.timestampSubject]).pipe(Object(d.a)(t=>{const e=Math.max(t[1]-Date.now(),0);return e<=0?this.placeholder:Math.ceil(e/1e3)+"s"}),Object(f.a)()).subscribe(new g.a(t=>{this.timestamp=t}))}ngOnDestroy(){this.updateSubscription&&this.updateSubscription.unsubscribe()}}return t.ngDirectiveDef=i.Qb({type:t,selectors:[["span","appCountdownTimer",""]],factory:function(e){return new(e||t)},hostBindings:function(t,e,s){1&t&&i.Ib(1),2&t&&i.ec("innerHTML",e.text,i.Fc)},inputs:{targetTime:"targetTime",placeholder:"placeholder"}}),t})(),O=(()=>{class t{}return t.ngModuleDef=i.Tb({type:t}),t.ngInjectorDef=i.Sb({factory:function(e){return new(e||t)},providers:[],imports:[[a.c,r.b],a.c,r.b]}),t})();var v=s("4R65"),D=s("pLZG"),w=s("5+tZ"),y=s("Z0Jl"),L=s("o0su"),E=s("6nr9"),I=s("XKTe"),S=s("LDfy");class T extends g.a{constructor(t){super(),this.followMapInstance=t}next(t){this.followMapInstance.setRoutePaths(t.paths)}}let j=(()=>{class t extends S.a{constructor(t,e,s,a,i){super(t,s,e,i),this.apiService=a,this.vehicleLocationSubject=new p.a(void 0),this.stopMarkerLayer=void 0,this.routePolyLines=[]}set location(t){this.vehicleLocationSubject.next(t)}get location(){return this.vehicleLocationSubject.getValue()}setRoutePaths(t){for(const e of this.routePolyLines)e.remove();this.routePolyLines=[];for(const e of t){const t=[];for(const a of e.wayPoints)t.push(new v.LatLng(a.lat/36e5,a.lon/36e5));const s=v.polyline(t,{color:e.color,opacity:.5,smoothFactor:1,weight:3});s.addTo(this.getMap()),this.routePolyLines.push(s)}}ngAfterViewInit(){super.ngAfterViewInit(),this.addMarker(),this.getMap().dragging.disable(),this.getMap().touchZoom.disable(),this.getMap().doubleClickZoom.disable(),this.getMap().scrollWheelZoom.disable(),this.getMap().eachLayer(t=>{t instanceof v.TileLayer&&(t.options.attribution="",t.redraw())})}addMarker(){this.updateObservable=this.vehicleLocationSubject.pipe(Object(d.a)(t=>t.vehicle)).subscribe(t=>{if(this.stopMarkerLayer?this.stopMarkerLayer.clearLayers():(this.stopMarkerLayer=new v.FeatureGroup,this.stopMarkerLayer.addTo(this.getMap())),t){const e=Object(y.b)(t.heading,t.name.split(" ")[0],40),s=v.marker([t.latitude/36e5,t.longitude/36e5],{icon:e,interactive:!1,title:t.name,zIndexOffset:100});s.setRotationAngle(t.heading-90),s.addTo(this.stopMarkerLayer),this.getMap().panTo({alt:2e3,lat:t.latitude/36e5,lng:t.longitude/36e5},{animate:!0})}}),this.vehicleLocationSubject.pipe(Object(D.a)(t=>null!==t),Object(f.a)(),Object(w.a)(t=>this.apiService.getRouteByTripId(t.vehicle.tripId))).subscribe(new T(this))}ngOnDestroy(){super.ngOnDestroy(),this.updateObservable.unsubscribe()}}return t.ngDirectiveDef=i.Qb({type:t,selectors:[["map","appTripPassages",""]],factory:function(e){return new(e||t)(i.Vb(i.q),i.Vb(I.a),i.Vb(i.K),i.Vb(L.a),i.Vb(E.a))},inputs:{location:"location"},features:[i.Fb]}),t})();var M=s("tyNb"),R=s("Cfvw"),P=s("Kj3r"),x=s("JIr8"),N=s("A3oB"),k=s("j14s");const C=[3,"blur","title"],A=["appTripPassages","","role","none",3,"location"],Z=["class","error-box","aria-errormessage","Error retrieving data",4,"ngIf"],_=["role","list",4,"ngIf"],V=[1,"error-box",6,"aria-errormessage"],U=["aria-errormessage",i.jc("Error retrieving data")],F=[1,"title"];var H;H=i.jc("An error occured (Code: {$interpolation})",{interpolation:"\ufffd0\ufffd"});const G=[1,"text"],Q=["appCountdownTimer","",3,"targetTime","placeholder"];function B(t,e){if(1&t&&(i.bc(0,"div",V),i.hc(1,U),i.bc(2,"span",F),i.fc(3,H),i.Zb(),i.bc(4,"span",G),i.Qc(5,"Retrying in"),i.bc(6,"span",Q),i.Qc(7,"test"),i.Zb(),i.Zb(),i.Zb()),2&t){const t=i.rc();i.Hc(3),i.ic(t.statusCode),i.gc(3),i.Hc(6),i.wc("targetTime",t.lastTimestamp+t.DEBOUNCE_TIME)("placeholder",'<i class="material-icons">sync</i>')}}const J=["role","list"],K=["role","listitem",3,"routerLink",4,"ngFor","ngForOf"],z=["role","listitem",3,"routerLink"],W=["matListIcon","","role","figure",6,"aria-label"],X=["aria-label",i.jc("Bus stop icon")],q=["matLine","",6,"aria-label"],Y=["aria-label",i.jc("Stop name")],$=["matLine",""],tt=["role","timer"],et=["role","status",1,"demo-2"],st=function(t){return["/stop",t]};function at(t,e){if(1&t&&(i.bc(0,"a",z),i.bc(1,"mat-list-item"),i.bc(2,"mat-icon",W),i.hc(3,X),i.Qc(4,"trip_origin"),i.Zb(),i.bc(5,"h3",q),i.hc(6,Y),i.Qc(7),i.Zb(),i.bc(8,"p",$),i.bc(9,"span",tt),i.Qc(10),i.Zb(),i.bc(11,"span",et),i.Qc(12),i.Zb(),i.Zb(),i.Zb(),i.Zb()),2&t){const t=e.$implicit;i.wc("routerLink",i.Ac(4,st,null==t?null:null==t.stop?null:t.stop.shortName)),i.Hc(7),i.Rc(null==t?null:null==t.stop?null:t.stop.name),i.Hc(10),i.Rc(null==t?null:t.actualTime),i.Hc(12),i.Sc("-- ",null==t?null:t.status,"")}}function it(t,e){if(1&t&&(i.bc(0,"mat-nav-list",J),i.Pc(1,at,13,6,"a",K),i.Zb()),2&t){const t=i.rc();i.Hc(1),i.wc("ngForOf",t.tripPassages)}}var rt=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({});let nt=(()=>{class t{constructor(t,e,s){this.route=t,this.apiService=e,this.router=s,this.DEBOUNCE_TIME=5e3,this.STATUS_OPS=rt,this.status=new p.a(void 0),this.snapshotDataSubscription=this.route.data.subscribe(t=>{this.status.next({passages:t.tripPassages,status:rt.LOADED,timestamp:Date.now()})})}get tripData(){if(this.status.value)return this.status.value.passages}get lastTimestamp(){return this.status.value?this.status.value.timestamp:0}get statusCode(){return this.status.value?this.status.value.status:rt.LOADING}get tripId(){return this.route.snapshot.params.tripId}get routeName(){return this.tripData?this.tripData.routeName:""}get tripPassages(){return void 0!==this.tripData?this.tripData.actual:[]}hasError(){return this.statusCode>=rt.ERROR}ngAfterViewInit(){this.pollSubscription=this.status.pipe(Object(P.a)(this.DEBOUNCE_TIME),Object(d.a)(()=>this.route.snapshot.params.tripId),Object(w.a)(t=>this.apiService.getTripPassages(t)),Object(d.a)(t=>({passages:t,status:rt.LOADED,timestamp:Date.now()})),Object(x.a)(this.handleError.bind(this))).subscribe(new g.a(t=>{this.status.next(t.passages.tripId===this.tripId?t:this.status.value)}))}ngOnDestroy(){this.snapshotDataSubscription&&this.snapshotDataSubscription.unsubscribe(),this.pollSubscription&&this.pollSubscription.unsubscribe()}handleError(t){let e=rt.ERROR;if(t.status){const s=t.status;404===s?(e=rt.NOT_FOUND,this.router.navigate(["not-found"],{queryParams:{type:"passages"}})):s>=500&&s<600&&(e=rt.SERVER_ERROR)}const s=Object.assign({},this.status.value);return s.status=e,s.failures?s.failures+=1:s.failures=1,Object(R.a)([s])}}return t.ngComponentDef=i.Pb({type:t,selectors:[["app-trip-passages"]],factory:function(e){return new(e||t)(i.Vb(M.a),i.Vb(L.a),i.Vb(M.f))},consts:4,vars:6,template:function(t,e){1&t&&(i.bc(0,"app-map-header-box",C),i.Wb(1,"map",A),i.Zb(),i.Pc(2,B,8,3,"div",Z),i.Pc(3,it,2,1,"mat-nav-list",_)),2&t&&(i.zc("title","",e.routeName," - ",null==e.tripData?null:e.tripData.directionText,""),i.wc("blur",e.hasError()),i.Hc(1),i.wc("location",null==e.tripData?null:e.tripData.location),i.Hc(2),i.wc("ngIf",e.hasError()),i.Hc(3),i.wc("ngIf",e.tripId==(null==e.tripData?null:e.tripData.tripId)))},directives:[N.a,j,a.k,m,n.f,a.j,M.h,n.c,r.a,n.b,k.f],styles:["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]}),t})();var ot=s("EY2u"),ct=s("UsLG");let ut=(()=>{class t{constructor(t,e){this.api=t,this.router=e}resolve(t,e){return this.api.getTripPassages(t.params.tripId).pipe(Object(x.a)(t=>(404===t.status&&this.router.navigate(["error","not-found"],{queryParams:{type:ct.a.PASSAGE_NOT_FOUND}}),ot.a)))}}return t.ngInjectableDef=i.Rb({token:t,factory:function(e){return new(e||t)(i.kc(L.a),i.kc(M.f))},providedIn:null}),t})();const lt=[{component:nt,data:{openSidebar:!0},path:":tripId",resolve:{tripPassages:ut}}];let pt=(()=>{class t{}return t.ngModuleDef=i.Tb({type:t}),t.ngInjectorDef=i.Sb({factory:function(e){return new(e||t)},imports:[[M.i.forChild(lt)],M.i]}),t})();M.i.forChild(lt),s.d(e,"TripPassagesModule",(function(){return bt}));let bt=(()=>{class t{}return t.ngModuleDef=i.Tb({type:t}),t.ngInjectorDef=i.Sb({factory:function(e){return new(e||t)},providers:[ut],imports:[[a.c,r.b,n.d,o.b,c.b,u.a,pt,l.a,O]]}),t})()}}]);