(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ZGAW:function(t,e,a){"use strict";a.r(e);var s=a("ofXK"),i=a("fXoL"),r=a("TY1r"),n=a("kEI4"),o=a("Xlwt"),c=a("J0hL"),u=a("G/Ji"),l=a("0DDv"),p=a("2Vo4"),b=a("itXk"),h=a("PqYM"),g=a("7o/Q"),d=a("lJxs"),m=a("/uUt");let f=(()=>{class t{constructor(){this.placeholder="-",this.timestamp="",this.timestampSubject=new p.a(0)}set targetTime(t){this.timestampSubject.next(t)}get text(){return this.timestamp}ngOnInit(){this.updateSubscription=Object(b.a)([Object(h.a)(0,200),this.timestampSubject]).pipe(Object(d.a)(t=>{const e=Math.max(t[1]-Date.now(),0);return e<=0?this.placeholder:Math.ceil(e/1e3)+"s"}),Object(m.a)()).subscribe(new g.a(t=>{this.timestamp=t}))}ngOnDestroy(){this.updateSubscription&&this.updateSubscription.unsubscribe()}}return t.ngDirectiveDef=i.Qb({type:t,selectors:[["span","appCountdownTimer",""]],factory:function(e){return new(e||t)},hostBindings:function(t,e,a){1&t&&i.Ib(1),2&t&&i.ec("innerHTML",e.text,i.Fc)},inputs:{targetTime:"targetTime",placeholder:"placeholder"}}),t})(),O=(()=>{class t{}return t.ngModuleDef=i.Tb({type:t}),t.ngInjectorDef=i.Sb({factory:function(e){return new(e||t)},providers:[],imports:[[s.c,r.b],s.c,r.b]}),t})();var D=a("4R65"),v=a("pLZG"),w=a("5+tZ"),y=a("Z0Jl"),E=a("o0su"),S=a("6nr9"),j=a("XKTe"),T=a("LDfy");let I=(()=>{class t extends T.a{constructor(t,e,a,s,i){super(t,a,e,i),this.apiService=s,this.vehicleLocationSubject=new p.a(void 0),this.stopMarkerLayer=void 0}set location(t){this.vehicleLocationSubject.next(t)}get location(){return this.vehicleLocationSubject.getValue()}ngAfterViewInit(){super.ngAfterViewInit(),this.addMarker(),this.getMap().dragging.disable(),this.getMap().touchZoom.disable(),this.getMap().doubleClickZoom.disable(),this.getMap().scrollWheelZoom.disable(),this.getMap().eachLayer(t=>{t instanceof D.TileLayer&&(t.options.attribution="",t.redraw())}),this.routeDisplayHandler=new y.a(this.getMap())}addMarker(){this.updateObservable=this.vehicleLocationSubject.pipe(Object(d.a)(t=>t.vehicle)).subscribe(t=>{if(this.stopMarkerLayer?this.stopMarkerLayer.clearLayers():(this.stopMarkerLayer=new D.FeatureGroup,this.stopMarkerLayer.addTo(this.getMap())),t){const e=Object(y.c)(t.heading,t.name.split(" ")[0],40),a=D.marker([t.latitude/36e5,t.longitude/36e5],{icon:e,interactive:!1,title:t.name,zIndexOffset:100});a.setRotationAngle(t.heading-90),a.addTo(this.stopMarkerLayer),this.getMap().panTo({alt:2e3,lat:t.latitude/36e5,lng:t.longitude/36e5},{animate:!0})}}),this.vehicleLocationSubject.pipe(Object(v.a)(t=>null!==t),Object(m.a)(),Object(w.a)(t=>this.apiService.getRouteByTripId(t.vehicle.tripId))).subscribe(new g.a(t=>{this.routeDisplayHandler.setRoutePaths(t.paths)}))}ngOnDestroy(){super.ngOnDestroy(),this.updateObservable.unsubscribe()}}return t.ngDirectiveDef=i.Qb({type:t,selectors:[["map","appTripPassages",""]],factory:function(e){return new(e||t)(i.Vb(i.q),i.Vb(j.a),i.Vb(i.K),i.Vb(E.a),i.Vb(S.a))},inputs:{location:"location"},features:[i.Fb]}),t})();var R=a("tyNb"),M=a("Cfvw"),L=a("Kj3r"),P=a("JIr8"),x=a("A3oB"),N=a("j14s");const k=[3,"blur","title"],C=["appTripPassages","","role","none",3,"location"],A=["class","error-box","aria-errormessage","Error retrieving data",4,"ngIf"],Z=["role","list",4,"ngIf"],_=[1,"error-box",6,"aria-errormessage"],V=["aria-errormessage",i.jc("Error retrieving data")],U=[1,"title"];var H;H=i.jc("An error occured (Code: {$interpolation})",{interpolation:"\ufffd0\ufffd"});const F=[1,"text"],G=["appCountdownTimer","",3,"targetTime","placeholder"];function Q(t,e){if(1&t&&(i.bc(0,"div",_),i.hc(1,V),i.bc(2,"span",U),i.fc(3,H),i.Zb(),i.bc(4,"span",F),i.Qc(5,"Retrying in"),i.bc(6,"span",G),i.Qc(7,"test"),i.Zb(),i.Zb(),i.Zb()),2&t){const t=i.rc();i.Hc(3),i.ic(t.statusCode),i.gc(3),i.Hc(6),i.wc("targetTime",t.lastTimestamp+t.DEBOUNCE_TIME)("placeholder",'<i class="material-icons">sync</i>')}}const B=["role","list"],J=["role","listitem",3,"routerLink",4,"ngFor","ngForOf"],K=["role","listitem",3,"routerLink"],z=["matListIcon","","role","figure",6,"aria-label"],W=["aria-label",i.jc("Bus stop icon")],X=["matLine","",6,"aria-label"],q=["aria-label",i.jc("Stop name")],Y=["matLine",""],$=["role","timer"],tt=["role","status",1,"demo-2"],et=function(t){return["/stop",t]};function at(t,e){if(1&t&&(i.bc(0,"a",K),i.bc(1,"mat-list-item"),i.bc(2,"mat-icon",z),i.hc(3,W),i.Qc(4,"trip_origin"),i.Zb(),i.bc(5,"h3",X),i.hc(6,q),i.Qc(7),i.Zb(),i.bc(8,"p",Y),i.bc(9,"span",$),i.Qc(10),i.Zb(),i.bc(11,"span",tt),i.Qc(12),i.Zb(),i.Zb(),i.Zb(),i.Zb()),2&t){const t=e.$implicit;i.wc("routerLink",i.Ac(4,et,null==t?null:null==t.stop?null:t.stop.shortName)),i.Hc(7),i.Rc(null==t?null:null==t.stop?null:t.stop.name),i.Hc(10),i.Rc(null==t?null:t.actualTime),i.Hc(12),i.Sc("-- ",null==t?null:t.status,"")}}function st(t,e){if(1&t&&(i.bc(0,"mat-nav-list",B),i.Pc(1,at,13,6,"a",J),i.Zb()),2&t){const t=i.rc();i.Hc(1),i.wc("ngForOf",t.tripPassages)}}var it=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({});let rt=(()=>{class t{constructor(t,e,a){this.route=t,this.apiService=e,this.router=a,this.DEBOUNCE_TIME=5e3,this.STATUS_OPS=it,this.status=new p.a(void 0),this.snapshotDataSubscription=this.route.data.subscribe(t=>{this.status.next({passages:t.tripPassages,status:it.LOADED,timestamp:Date.now()})})}get tripData(){if(this.status.value)return this.status.value.passages}get lastTimestamp(){return this.status.value?this.status.value.timestamp:0}get statusCode(){return this.status.value?this.status.value.status:it.LOADING}get tripId(){return this.route.snapshot.params.tripId}get routeName(){return this.tripData?this.tripData.routeName:""}get tripPassages(){return void 0!==this.tripData?this.tripData.actual:[]}hasError(){return this.statusCode>=it.ERROR}ngAfterViewInit(){this.pollSubscription=this.status.pipe(Object(L.a)(this.DEBOUNCE_TIME),Object(d.a)(()=>this.route.snapshot.params.tripId),Object(w.a)(t=>this.apiService.getTripPassages(t)),Object(d.a)(t=>({passages:t,status:it.LOADED,timestamp:Date.now()})),Object(P.a)(this.handleError.bind(this))).subscribe(new g.a(t=>{this.status.next(t.passages.tripId===this.tripId?t:this.status.value)}))}ngOnDestroy(){this.snapshotDataSubscription&&this.snapshotDataSubscription.unsubscribe(),this.pollSubscription&&this.pollSubscription.unsubscribe()}handleError(t){let e=it.ERROR;if(t.status){const a=t.status;404===a?(e=it.NOT_FOUND,this.router.navigate(["not-found"],{queryParams:{type:"passages"}})):a>=500&&a<600&&(e=it.SERVER_ERROR)}const a=Object.assign({},this.status.value);return a.status=e,a.failures?a.failures+=1:a.failures=1,Object(M.a)([a])}}return t.ngComponentDef=i.Pb({type:t,selectors:[["app-trip-passages"]],factory:function(e){return new(e||t)(i.Vb(R.a),i.Vb(E.a),i.Vb(R.f))},consts:4,vars:6,template:function(t,e){1&t&&(i.bc(0,"app-map-header-box",k),i.Wb(1,"map",C),i.Zb(),i.Pc(2,Q,8,3,"div",A),i.Pc(3,st,2,1,"mat-nav-list",Z)),2&t&&(i.zc("title","",e.routeName," - ",null==e.tripData?null:e.tripData.directionText,""),i.wc("blur",e.hasError()),i.Hc(1),i.wc("location",null==e.tripData?null:e.tripData.location),i.Hc(2),i.wc("ngIf",e.hasError()),i.Hc(3),i.wc("ngIf",e.tripId==(null==e.tripData?null:e.tripData.tripId)))},directives:[x.a,I,s.k,f,n.f,s.j,R.h,n.c,r.a,n.b,N.f],styles:["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]}),t})();var nt=a("EY2u"),ot=a("UsLG");let ct=(()=>{class t{constructor(t,e){this.api=t,this.router=e}resolve(t,e){return this.api.getTripPassages(t.params.tripId).pipe(Object(P.a)(t=>(404===t.status&&this.router.navigate(["error","not-found"],{queryParams:{type:ot.a.PASSAGE_NOT_FOUND}}),nt.a)))}}return t.ngInjectableDef=i.Rb({token:t,factory:function(e){return new(e||t)(i.kc(E.a),i.kc(R.f))},providedIn:null}),t})();const ut=[{component:rt,data:{openSidebar:!0},path:":tripId",resolve:{tripPassages:ct}}];let lt=(()=>{class t{}return t.ngModuleDef=i.Tb({type:t}),t.ngInjectorDef=i.Sb({factory:function(e){return new(e||t)},imports:[[R.i.forChild(ut)],R.i]}),t})();R.i.forChild(ut),a.d(e,"TripPassagesModule",(function(){return pt}));let pt=(()=>{class t{}return t.ngModuleDef=i.Tb({type:t}),t.ngInjectorDef=i.Sb({factory:function(e){return new(e||t)},providers:[ct],imports:[[s.c,r.b,n.d,o.b,c.b,u.a,lt,l.a,O]]}),t})()}}]);