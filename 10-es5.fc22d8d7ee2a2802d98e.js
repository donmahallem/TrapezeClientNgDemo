function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{ZGAW:function(t,e,r){"use strict";r.r(e);var a,i,n,o,s=r("ofXK"),c=r("fXoL"),u=r("TY1r"),p=r("kEI4"),l=r("Xlwt"),b=r("J0hL"),f=r("G/Ji"),h=r("0DDv"),g=r("2Vo4"),d=r("itXk"),v=r("PqYM"),m=r("7o/Q"),y=r("lJxs"),O=r("/uUt"),D=((i=function(){function t(){this.placeholder="-",this.timestamp="",this.timestampSubject=new g.a(0)}var e=t.prototype;return e.ngOnInit=function(){var t=this;this.updateSubscription=Object(d.a)([Object(v.a)(0,200),this.timestampSubject]).pipe(Object(y.a)(function(e){var r=Math.max(e[1]-Date.now(),0);return r<=0?t.placeholder:Math.ceil(r/1e3)+"s"}),Object(O.a)()).subscribe(new m.a(function(e){t.timestamp=e}))},e.ngOnDestroy=function(){this.updateSubscription&&this.updateSubscription.unsubscribe()},_createClass(t,[{key:"targetTime",set:function(t){this.timestampSubject.next(t)}},{key:"text",get:function(){return this.timestamp}}]),t}()).ngDirectiveDef=c.Qb({type:i,selectors:[["span","appCountdownTimer",""]],factory:function(t){return new(t||i)},hostBindings:function(t,e,r){1&t&&c.Ib(1),2&t&&c.ec("innerHTML",e.text,c.Fc)},inputs:{targetTime:"targetTime",placeholder:"placeholder"}}),i),w=((a=function(){}).ngModuleDef=c.Tb({type:a}),a.ngInjectorDef=c.Sb({factory:function(t){return new(t||a)},providers:[],imports:[[s.c,u.b],s.c,u.b]}),a),L=r("4R65"),k=r("pLZG"),j=r("5+tZ"),S=r("Z0Jl"),E=r("o0su"),I=r("6nr9"),M=r("XKTe"),P=r("LDfy"),R=function(t){function e(e){var r;return(r=t.call(this)||this).followMapInstance=e,r}return _inheritsLoose(e,t),e.prototype.next=function(t){this.followMapInstance.setRoutePaths(t.paths)},e}(m.a),T=((n=function(t){function e(e,r,a,i,n){var o;return(o=t.call(this,e,a,r,n)||this).apiService=i,o.vehicleLocationSubject=new g.a(void 0),o.stopMarkerLayer=void 0,o.routePolyLines=[],o}_inheritsLoose(e,t);var r=e.prototype;return r.setRoutePaths=function(t){var e=this.routePolyLines,r=Array.isArray(e),a=0;for(e=r?e:e[Symbol.iterator]();;){var i;if(r){if(a>=e.length)break;i=e[a++]}else{if((a=e.next()).done)break;i=a.value}i.remove()}this.routePolyLines=[];var n=t,o=Array.isArray(n),s=0;for(n=o?n:n[Symbol.iterator]();;){var c;if(o){if(s>=n.length)break;c=n[s++]}else{if((s=n.next()).done)break;c=s.value}var u=c,p=[],l=u.wayPoints,b=Array.isArray(l),f=0;for(l=b?l:l[Symbol.iterator]();;){var h;if(b){if(f>=l.length)break;h=l[f++]}else{if((f=l.next()).done)break;h=f.value}var g=h;p.push(new L.LatLng(g.lat/36e5,g.lon/36e5))}var d=L.polyline(p,{color:u.color,opacity:.5,smoothFactor:1,weight:3});d.addTo(this.getMap()),this.routePolyLines.push(d)}},r.ngAfterViewInit=function(){t.prototype.ngAfterViewInit.call(this),this.addMarker(),this.getMap().dragging.disable(),this.getMap().touchZoom.disable(),this.getMap().doubleClickZoom.disable(),this.getMap().scrollWheelZoom.disable(),this.getMap().eachLayer(function(t){t instanceof L.TileLayer&&(t.options.attribution="",t.redraw())})},r.addMarker=function(){var t=this;this.updateObservable=this.vehicleLocationSubject.pipe(Object(y.a)(function(t){return t.vehicle})).subscribe(function(e){if(t.stopMarkerLayer?t.stopMarkerLayer.clearLayers():(t.stopMarkerLayer=new L.FeatureGroup,t.stopMarkerLayer.addTo(t.getMap())),e){var r=Object(S.b)(e.heading,e.name.split(" ")[0],40),a=L.marker([e.latitude/36e5,e.longitude/36e5],{icon:r,interactive:!1,title:e.name,zIndexOffset:100});a.setRotationAngle(e.heading-90),a.addTo(t.stopMarkerLayer),t.getMap().panTo({alt:2e3,lat:e.latitude/36e5,lng:e.longitude/36e5},{animate:!0})}}),this.vehicleLocationSubject.pipe(Object(k.a)(function(t){return null!==t}),Object(O.a)(),Object(j.a)(function(e){return t.apiService.getRouteByTripId(e.vehicle.tripId)})).subscribe(new R(this))},r.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this.updateObservable.unsubscribe()},_createClass(e,[{key:"location",set:function(t){this.vehicleLocationSubject.next(t)},get:function(){return this.vehicleLocationSubject.getValue()}}]),e}(P.a)).ngDirectiveDef=c.Qb({type:n,selectors:[["map","appTripPassages",""]],factory:function(t){return new(t||n)(c.Vb(c.q),c.Vb(M.a),c.Vb(c.K),c.Vb(E.a),c.Vb(I.a))},inputs:{location:"location"},features:[c.Fb]}),n),_=r("tyNb"),x=r("Cfvw"),C=r("Kj3r"),A=r("JIr8"),N=r("A3oB"),Z=r("j14s"),V=[3,"blur","title"],U=["appTripPassages","","role","none",3,"location"],F=["class","error-box","aria-errormessage","Error retrieving data",4,"ngIf"],H=["role","list",4,"ngIf"],Q=[1,"error-box",6,"aria-errormessage"],B=["aria-errormessage",c.jc("Error retrieving data")],G=[1,"title"];o=c.jc("An error occured (Code: {$interpolation})",{interpolation:"\ufffd0\ufffd"});var J=[1,"text"],K=["appCountdownTimer","",3,"targetTime","placeholder"];function z(t,e){if(1&t&&(c.bc(0,"div",Q),c.hc(1,B),c.bc(2,"span",G),c.fc(3,o),c.Zb(),c.bc(4,"span",J),c.Qc(5,"Retrying in"),c.bc(6,"span",K),c.Qc(7,"test"),c.Zb(),c.Zb(),c.Zb()),2&t){var r=c.rc();c.Hc(3),c.ic(r.statusCode),c.gc(3),c.Hc(6),c.wc("targetTime",r.lastTimestamp+r.DEBOUNCE_TIME)("placeholder",'<i class="material-icons">sync</i>')}}var W=["role","list"],X=["role","listitem",3,"routerLink",4,"ngFor","ngForOf"],q=["role","listitem",3,"routerLink"],Y=["matListIcon","","role","figure",6,"aria-label"],$=["aria-label",c.jc("Bus stop icon")],tt=["matLine","",6,"aria-label"],et=["aria-label",c.jc("Stop name")],rt=["matLine",""],at=["role","timer"],it=["role","status",1,"demo-2"],nt=function(t){return["/stop",t]};function ot(t,e){if(1&t&&(c.bc(0,"a",q),c.bc(1,"mat-list-item"),c.bc(2,"mat-icon",Y),c.hc(3,$),c.Qc(4,"trip_origin"),c.Zb(),c.bc(5,"h3",tt),c.hc(6,et),c.Qc(7),c.Zb(),c.bc(8,"p",rt),c.bc(9,"span",at),c.Qc(10),c.Zb(),c.bc(11,"span",it),c.Qc(12),c.Zb(),c.Zb(),c.Zb(),c.Zb()),2&t){var r=e.$implicit;c.wc("routerLink",c.Ac(4,nt,null==r?null:null==r.stop?null:r.stop.shortName)),c.Hc(7),c.Rc(null==r?null:null==r.stop?null:r.stop.name),c.Hc(10),c.Rc(null==r?null:r.actualTime),c.Hc(12),c.Sc("-- ",null==r?null:r.status,"")}}function st(t,e){if(1&t&&(c.bc(0,"mat-nav-list",W),c.Pc(1,ot,13,6,"a",X),c.Zb()),2&t){var r=c.rc();c.Hc(1),c.wc("ngForOf",r.tripPassages)}}var ct,ut,pt,lt=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({}),bt=((ct=function(){function t(t,e,r){var a=this;this.route=t,this.apiService=e,this.router=r,this.DEBOUNCE_TIME=5e3,this.STATUS_OPS=lt,this.status=new g.a(void 0),this.snapshotDataSubscription=this.route.data.subscribe(function(t){a.status.next({passages:t.tripPassages,status:lt.LOADED,timestamp:Date.now()})})}var e=t.prototype;return e.hasError=function(){return this.statusCode>=lt.ERROR},e.ngAfterViewInit=function(){var t=this;this.pollSubscription=this.status.pipe(Object(C.a)(this.DEBOUNCE_TIME),Object(y.a)(function(){return t.route.snapshot.params.tripId}),Object(j.a)(function(e){return t.apiService.getTripPassages(e)}),Object(y.a)(function(t){return{passages:t,status:lt.LOADED,timestamp:Date.now()}}),Object(A.a)(this.handleError.bind(this))).subscribe(new m.a(function(e){t.status.next(e.passages.tripId===t.tripId?e:t.status.value)}))},e.ngOnDestroy=function(){this.snapshotDataSubscription&&this.snapshotDataSubscription.unsubscribe(),this.pollSubscription&&this.pollSubscription.unsubscribe()},e.handleError=function(t){var e=lt.ERROR;if(t.status){var r=t.status;404===r?(e=lt.NOT_FOUND,this.router.navigate(["not-found"],{queryParams:{type:"passages"}})):r>=500&&r<600&&(e=lt.SERVER_ERROR)}var a=Object.assign({},this.status.value);return a.status=e,a.failures?a.failures+=1:a.failures=1,Object(x.a)([a])},_createClass(t,[{key:"tripData",get:function(){if(this.status.value)return this.status.value.passages}},{key:"lastTimestamp",get:function(){return this.status.value?this.status.value.timestamp:0}},{key:"statusCode",get:function(){return this.status.value?this.status.value.status:lt.LOADING}},{key:"tripId",get:function(){return this.route.snapshot.params.tripId}},{key:"routeName",get:function(){return this.tripData?this.tripData.routeName:""}},{key:"tripPassages",get:function(){return void 0!==this.tripData?this.tripData.actual:[]}}]),t}()).ngComponentDef=c.Pb({type:ct,selectors:[["app-trip-passages"]],factory:function(t){return new(t||ct)(c.Vb(_.a),c.Vb(E.a),c.Vb(_.f))},consts:4,vars:6,template:function(t,e){1&t&&(c.bc(0,"app-map-header-box",V),c.Wb(1,"map",U),c.Zb(),c.Pc(2,z,8,3,"div",F),c.Pc(3,st,2,1,"mat-nav-list",H)),2&t&&(c.zc("title","",e.routeName," - ",null==e.tripData?null:e.tripData.directionText,""),c.wc("blur",e.hasError()),c.Hc(1),c.wc("location",null==e.tripData?null:e.tripData.location),c.Hc(2),c.wc("ngIf",e.hasError()),c.Hc(3),c.wc("ngIf",e.tripId==(null==e.tripData?null:e.tripData.tripId)))},directives:[N.a,T,s.k,D,p.f,s.j,_.h,p.c,u.a,p.b,Z.f],styles:["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]}),ct),ft=r("EY2u"),ht=((ut=function(){function t(t,e){this.api=t,this.router=e}return t.prototype.resolve=function(t,e){var r=this;return this.api.getTripPassages(t.params.tripId).pipe(Object(A.a)(function(t){return 404===t.status&&r.router.navigate(["not-found"]),ft.a}))},t}()).ngInjectableDef=c.Rb({token:ut,factory:function(t){return new(t||ut)(c.kc(E.a),c.kc(_.f))},providedIn:null}),ut),gt=[{component:bt,data:{openSidebar:!0},path:":tripId",resolve:{tripPassages:ht}}],dt=((pt=function(){}).ngModuleDef=c.Tb({type:pt}),pt.ngInjectorDef=c.Sb({factory:function(t){return new(t||pt)},imports:[[_.i.forChild(gt)],_.i]}),pt);_.i.forChild(gt),r.d(e,"TripPassagesModule",function(){return mt});var vt,mt=((vt=function(){}).ngModuleDef=c.Tb({type:vt}),vt.ngInjectorDef=c.Sb({factory:function(t){return new(t||vt)},providers:[ht],imports:[[s.c,u.b,p.d,l.b,b.b,f.a,dt,h.a,w]]}),vt)}}]);