(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{juSB:function(t,n,e){"use strict";e.r(n);var l=e("CcnG"),a=function(){return function(){}}(),i=e("pMnS"),r=e("26FU"),u=e("dzgT"),o=e("gI3B"),s=e("FFOo"),c=e("67Y/"),p=e("ad02"),b=function(){function t(){this.placeholder="-",this.timestamp="",this.timestampSubject=new r.a(0)}return Object.defineProperty(t.prototype,"targetTime",{set:function(t){this.timestampSubject.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.timestamp},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.updateSubscription=Object(u.a)([Object(o.a)(0,200),this.timestampSubject]).pipe(Object(c.a)(function(n){var e=Math.max(n[1]-Date.now(),0);return e<=0?t.placeholder:Math.ceil(e/1e3)+"s"}),Object(p.a)()).subscribe(new s.a(function(n){t.timestamp=n}))},t.prototype.ngOnDestroy=function(){this.updateSubscription&&this.updateSubscription.unsubscribe()},t}(),f=e("ZYCi"),h=e("Ip0R"),m=e("6UMx"),g=e("0/Q6"),d=e("Mr+X"),O=e("SMsm"),v=e("Wf4p"),y=e("jWaI"),j=e("A3oB"),D=e("mrSG"),L=e("4R65"),A=e("VnD/"),M=e("psW0"),R=e("Z0Jl"),x=(e("o0su"),e("6nr9")),E=e("XKTe"),P=e("LDfy"),C=function(t){function n(n){var e=t.call(this)||this;return e.followMapInstance=n,e}return Object(D.c)(n,t),n.prototype.next=function(t){this.followMapInstance.setRoutePaths(t.paths)},n}(s.a),S=function(t){function n(n,e,l,a,i){var u=t.call(this,n,l,e,i)||this;return u.apiService=a,u.vehicleLocationSubject=new r.a(void 0),u.stopMarkerLayer=void 0,u.routePolyLines=[],u}return Object(D.c)(n,t),Object.defineProperty(n.prototype,"location",{get:function(){return this.vehicleLocationSubject.getValue()},set:function(t){this.vehicleLocationSubject.next(t)},enumerable:!0,configurable:!0}),n.prototype.setRoutePaths=function(t){for(var n=0,e=this.routePolyLines;n<e.length;n++)e[n].remove();this.routePolyLines=[];for(var l=0,a=t;l<a.length;l++){for(var i=a[l],r=[],u=0,o=i.wayPoints;u<o.length;u++){var s=o[u];r.push(new L.LatLng(s.lat/36e5,s.lon/36e5))}var c=L.polyline(r,{color:i.color,opacity:.5,smoothFactor:1,weight:3});c.addTo(this.getMap()),this.routePolyLines.push(c)}},n.prototype.ngAfterViewInit=function(){t.prototype.ngAfterViewInit.call(this),this.addMarker(),this.getMap().dragging.disable(),this.getMap().touchZoom.disable(),this.getMap().doubleClickZoom.disable(),this.getMap().scrollWheelZoom.disable(),this.getMap().eachLayer(function(t){t instanceof L.TileLayer&&(t.options.attribution="",t.redraw())})},n.prototype.addMarker=function(){var t=this;this.updateObservable=this.vehicleLocationSubject.pipe(Object(c.a)(function(t){return t.vehicle})).subscribe(function(n){if(t.stopMarkerLayer?t.stopMarkerLayer.clearLayers():(t.stopMarkerLayer=new L.FeatureGroup,t.stopMarkerLayer.addTo(t.getMap())),n){var e=Object(R.b)(n.heading,n.name.split(" ")[0],40),l=L.marker([n.latitude/36e5,n.longitude/36e5],{clickable:!1,icon:e,interactive:!1,title:n.name,zIndexOffset:100});l.setRotationAngle(n.heading-90),l.addTo(t.stopMarkerLayer),t.getMap().panTo({alt:2e3,lat:n.latitude/36e5,lng:n.longitude/36e5},{animate:!0})}}),this.vehicleLocationSubject.pipe(Object(A.a)(function(t){return null!==t}),Object(p.a)(),Object(M.a)(function(n){return t.apiService.getRouteByTripId(n.vehicle.tripId)})).subscribe(new C(this))},n.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this.updateObservable.unsubscribe()},n}(P.a),I=e("H+bZ"),w=e("0/uQ"),k=e("Gi3i"),T=e("9Z1F"),N=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({}),_=function(){function t(t,n,e){var l=this;this.route=t,this.apiService=n,this.router=e,this.DEBOUNCE_TIME=5e3,this.StatusOps=N,this.status=new r.a(void 0),this.snapshotDataSubscription=this.route.data.subscribe(function(t){l.status.next({passages:t.tripPassages,status:N.LOADED,timestamp:Date.now()})})}return Object.defineProperty(t.prototype,"tripData",{get:function(){if(this.status.value)return this.status.value.passages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastTimestamp",{get:function(){return this.status.value?this.status.value.timestamp:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"statusCode",{get:function(){return this.status.value?this.status.value.status:N.LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tripId",{get:function(){return this.route.snapshot.params.tripId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"routeName",{get:function(){return this.tripData?this.tripData.routeName:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tripPassages",{get:function(){return void 0!==this.tripData?this.tripData.actual:[]},enumerable:!0,configurable:!0}),t.prototype.hasError=function(){return this.statusCode>=N.ERROR},t.prototype.ngAfterViewInit=function(){var t=this;this.pollSubscription=this.status.pipe(Object(k.a)(this.DEBOUNCE_TIME),Object(c.a)(function(){return t.route.snapshot.params.tripId}),Object(M.a)(function(n){return t.apiService.getTripPassages(n)}),Object(c.a)(function(t){return{passages:t,status:N.LOADED,timestamp:Date.now()}}),Object(T.a)(this.handleError.bind(this))).subscribe(new s.a(function(n){t.status.next(n.passages.tripId===t.tripId?n:t.status.value)}))},t.prototype.ngOnDestroy=function(){this.snapshotDataSubscription&&this.snapshotDataSubscription.unsubscribe(),this.pollSubscription&&this.pollSubscription.unsubscribe()},t.prototype.handleError=function(t){var n=N.ERROR;if(t.status){var e=t.status;404===e?(n=N.NOT_FOUND,this.router.navigate(["not-found"],{queryParams:{type:"passages"}})):e>=500&&e<600&&(n=N.SERVER_ERROR)}var l=Object.assign({},this.status.value);return l.status=n,l.failures?l.failures+=1:l.failures=1,Object(w.a)([l])},t}(),F=l.qb({encapsulation:0,styles:[["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]],data:{}});function U(t){return l.Lb(0,[(t()(),l.sb(0,0,null,null,7,"div",[["aria-errormessage","Error retrieving data"],["class","error-box"]],null,null,null,null,null)),(t()(),l.sb(1,0,null,null,1,"span",[["class","title"]],null,null,null,null,null)),(t()(),l.Jb(2,null,["An error occured (Code: ",")"])),(t()(),l.sb(3,0,null,null,4,"span",[["class","text"]],null,null,null,null,null)),(t()(),l.Jb(-1,null,["Retrying in"])),(t()(),l.sb(5,0,null,null,2,"span",[["appCountdownTimer",""]],[[8,"innerHTML",1]],null,null,null,null)),l.rb(6,212992,null,0,b,[],{targetTime:[0,"targetTime"],placeholder:[1,"placeholder"]},null),(t()(),l.Jb(-1,null,["test"]))],function(t,n){var e=n.component;t(n,6,0,e.lastTimestamp+e.DEBOUNCE_TIME,'<i class="material-icons">sync</i>')},function(t,n){t(n,2,0,n.component.statusCode),t(n,5,0,l.Cb(n,6).text)})}function J(t){return l.Lb(0,[(t()(),l.sb(0,0,null,null,20,"a",[["role","listitem"]],[[1,"target",0],[8,"href",4]],[[null,"click"]],function(t,n,e){var a=!0;return"click"===n&&(a=!1!==l.Cb(t,1).onClick(e.button,e.ctrlKey,e.metaKey,e.shiftKey)&&a),a},null,null)),l.rb(1,671744,null,0,f.q,[f.o,f.a,h.h],{routerLink:[0,"routerLink"]},null),l.Db(2,2),(t()(),l.sb(3,0,null,null,17,"mat-list-item",[["class","mat-list-item"]],[[2,"mat-list-item-avatar",null],[2,"mat-list-item-with-avatar",null]],null,null,m.d,m.b)),l.rb(4,1228800,null,3,g.c,[l.k,[2,g.g],[2,g.a],l.h],null,null),l.Hb(603979776,1,{_lines:1}),l.Hb(335544320,2,{_avatar:0}),l.Hb(335544320,3,{_icon:0}),(t()(),l.sb(8,0,null,0,3,"mat-icon",[["aria-label","Bus stop icon"],["class","mat-icon notranslate mat-list-icon"],["matListIcon",""],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,d.b,d.a)),l.rb(9,9158656,null,0,O.b,[l.k,O.d,[8,null],[2,O.a]],null,null),l.rb(10,16384,[[3,4]],0,g.b,[],null,null),(t()(),l.Jb(-1,0,["trip_origin"])),(t()(),l.sb(12,0,null,1,2,"h3",[["aria-label","Stop name"],["class","mat-line"],["matLine",""]],null,null,null,null,null)),l.rb(13,16384,[[1,4]],0,v.k,[],null,null),(t()(),l.Jb(14,null,["",""])),(t()(),l.sb(15,0,null,1,5,"p",[["class","mat-line"],["matLine",""]],null,null,null,null,null)),l.rb(16,16384,[[1,4]],0,v.k,[],null,null),(t()(),l.sb(17,0,null,null,1,"span",[["role","timer"]],null,null,null,null,null)),(t()(),l.Jb(18,null,["",""])),(t()(),l.sb(19,0,null,null,1,"span",[["class","demo-2"],["role","status"]],null,null,null,null,null)),(t()(),l.Jb(20,null,["-- ",""]))],function(t,n){var e=t(n,2,0,"/stop",null==n.context.$implicit?null:null==n.context.$implicit.stop?null:n.context.$implicit.stop.shortName);t(n,1,0,e),t(n,9,0)},function(t,n){t(n,0,0,l.Cb(n,1).target,l.Cb(n,1).href),t(n,3,0,l.Cb(n,4)._avatar||l.Cb(n,4)._icon,l.Cb(n,4)._avatar||l.Cb(n,4)._icon),t(n,8,0,l.Cb(n,9).inline,"primary"!==l.Cb(n,9).color&&"accent"!==l.Cb(n,9).color&&"warn"!==l.Cb(n,9).color),t(n,14,0,null==n.context.$implicit?null:null==n.context.$implicit.stop?null:n.context.$implicit.stop.name),t(n,18,0,null==n.context.$implicit?null:n.context.$implicit.actualTime),t(n,20,0,null==n.context.$implicit?null:n.context.$implicit.status)})}function $(t){return l.Lb(0,[(t()(),l.sb(0,0,null,null,3,"mat-nav-list",[["class","mat-nav-list mat-list-base"],["role","navigation"]],null,null,null,m.f,m.c)),l.rb(1,704512,null,0,g.g,[],null,null),(t()(),l.jb(16777216,null,0,1,null,J)),l.rb(3,278528,null,0,h.j,[l.R,l.N,l.t],{ngForOf:[0,"ngForOf"]},null)],function(t,n){t(n,3,0,n.component.tripPassages)},null)}function B(t){return l.Lb(0,[(t()(),l.sb(0,0,null,null,3,"app-map-header-box",[],[[2,"no-location",null]],null,null,y.b,y.a)),l.rb(1,49152,null,0,j.a,[],{title:[0,"title"],blur:[1,"blur"]},null),(t()(),l.sb(2,0,null,0,1,"map",[["appTripPassages",""],["role","none"]],null,null,null,null,null)),l.rb(3,4341760,null,0,S,[l.k,E.a,l.A,I.a,x.a],{location:[0,"location"]},null),(t()(),l.jb(16777216,null,null,1,null,U)),l.rb(5,16384,null,0,h.k,[l.R,l.N],{ngIf:[0,"ngIf"]},null),(t()(),l.jb(16777216,null,null,1,null,$)),l.rb(7,16384,null,0,h.k,[l.R,l.N],{ngIf:[0,"ngIf"]},null)],function(t,n){var e=n.component;t(n,1,0,l.ub(2,"",e.routeName," - ",null==e.tripData?null:e.tripData.directionText,""),e.hasError()),t(n,3,0,null==e.tripData?null:e.tripData.location),t(n,5,0,e.hasError()),t(n,7,0,e.tripId==(null==e.tripData?null:e.tripData.tripId))},function(t,n){t(n,0,0,l.Cb(n,1).blur)})}function Z(t){return l.Lb(0,[(t()(),l.sb(0,0,null,null,1,"app-trip-passages",[],null,null,null,B,F)),l.rb(1,4374528,null,0,_,[f.a,I.a,f.o],null,null)],null,null)}var G=l.ob("app-trip-passages",_,Z,{},{},[]),V=e("G5J1"),z=function(){function t(t,n){this.api=t,this.router=n}return t.prototype.resolve=function(t,n){var e=this;return this.api.getTripPassages(t.params.tripId).pipe(Object(T.a)(function(t){return 404===t.status&&e.router.navigate(["not-found"]),V.a}))},t}(),W=e("Fzqc"),H=e("ZYjt"),K=e("dWZg"),q=e("LC5p"),Y=e("UodH"),Q=e("8mMr"),X=e("Blfk"),tt={openSidebar:!0},nt=function(){return function(){}}(),et=e("DmY8"),lt=function(){return function(){}}();e.d(n,"TripPassagesModuleNgFactory",function(){return at});var at=l.pb(a,[],function(t){return l.zb([l.Ab(512,l.j,l.eb,[[8,[i.a,G]],[3,l.j],l.y]),l.Ab(4608,h.m,h.l,[l.v,[2,h.w]]),l.Ab(4608,z,z,[I.a,f.o]),l.Ab(1073742336,h.c,h.c,[]),l.Ab(1073742336,W.a,W.a,[]),l.Ab(1073742336,v.j,v.j,[[2,v.c],[2,H.g]]),l.Ab(1073742336,O.c,O.c,[]),l.Ab(1073742336,v.l,v.l,[]),l.Ab(1073742336,K.b,K.b,[]),l.Ab(1073742336,v.u,v.u,[]),l.Ab(1073742336,v.s,v.s,[]),l.Ab(1073742336,q.b,q.b,[]),l.Ab(1073742336,g.d,g.d,[]),l.Ab(1073742336,Y.c,Y.c,[]),l.Ab(1073742336,Q.b,Q.b,[]),l.Ab(1073742336,X.a,X.a,[]),l.Ab(1073742336,f.r,f.r,[[2,f.x],[2,f.o]]),l.Ab(1073742336,nt,nt,[]),l.Ab(1073742336,et.a,et.a,[]),l.Ab(1073742336,lt,lt,[]),l.Ab(1073742336,a,a,[]),l.Ab(1024,f.m,function(){return[[{component:_,data:tt,path:":tripId",resolve:{tripPassages:z}}]]},[])])})}}]);