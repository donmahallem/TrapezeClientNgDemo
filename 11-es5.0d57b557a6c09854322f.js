var __extends=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ZGAW:function(t,e,r){"use strict";r.r(e);var n,i,a,o,s=r("ofXK"),c=r("fXoL"),u=r("TY1r"),p=r("kEI4"),l=r("Xlwt"),b=r("J0hL"),f=r("G/Ji"),h=r("0DDv"),d=r("2Vo4"),g=r("itXk"),m=r("PqYM"),y=r("7o/Q"),O=r("lJxs"),v=r("/uUt"),D=((i=function(){function t(){this.placeholder="-",this.timestamp="",this.timestampSubject=new d.a(0)}return Object.defineProperty(t.prototype,"targetTime",{set:function(t){this.timestampSubject.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.timestamp},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.updateSubscription=Object(g.a)([Object(m.a)(0,200),this.timestampSubject]).pipe(Object(O.a)((function(e){var r=Math.max(e[1]-Date.now(),0);return r<=0?t.placeholder:Math.ceil(r/1e3)+"s"})),Object(v.a)()).subscribe(new y.a((function(e){t.timestamp=e})))},t.prototype.ngOnDestroy=function(){this.updateSubscription&&this.updateSubscription.unsubscribe()},t}()).ngDirectiveDef=c.Qb({type:i,selectors:[["span","appCountdownTimer",""]],factory:function(t){return new(t||i)},hostBindings:function(t,e,r){1&t&&c.Ib(1),2&t&&c.ec("innerHTML",e.text,c.Fc)},inputs:{targetTime:"targetTime",placeholder:"placeholder"}}),i),j=((n=function(){}).ngModuleDef=c.Tb({type:n}),n.ngInjectorDef=c.Sb({factory:function(t){return new(t||n)},providers:[],imports:[[s.c,u.b],s.c,u.b]}),n),w=r("4R65"),P=r("pLZG"),E=r("5+tZ"),S=r("Z0Jl"),T=r("o0su"),I=r("6nr9"),R=r("XKTe"),M=r("LDfy"),_=((a=function(t){function e(e,r,n,i,a){var o=this;return(o=t.call(this,e,n,r,a)||this).apiService=i,o.vehicleLocationSubject=new d.a(void 0),o.stopMarkerLayer=void 0,o}return __extends(e,t),Object.defineProperty(e.prototype,"location",{get:function(){return this.vehicleLocationSubject.getValue()},set:function(t){this.vehicleLocationSubject.next(t)},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){t.prototype.ngAfterViewInit.call(this),this.addMarker(),this.getMap().dragging.disable(),this.getMap().touchZoom.disable(),this.getMap().doubleClickZoom.disable(),this.getMap().scrollWheelZoom.disable(),this.getMap().eachLayer((function(t){t instanceof w.TileLayer&&(t.options.attribution="",t.redraw())})),this.routeDisplayHandler=new S.a(this.getMap())},e.prototype.addMarker=function(){var t=this;this.updateObservable=this.vehicleLocationSubject.pipe(Object(O.a)((function(t){return t.vehicle}))).subscribe((function(e){if(t.stopMarkerLayer?t.stopMarkerLayer.clearLayers():(t.stopMarkerLayer=new w.FeatureGroup,t.stopMarkerLayer.addTo(t.getMap())),e){var r=Object(S.c)(e.heading,e.name.split(" ")[0],40),n=w.marker([e.latitude/36e5,e.longitude/36e5],{icon:r,interactive:!1,title:e.name,zIndexOffset:100});n.setRotationAngle(e.heading-90),n.addTo(t.stopMarkerLayer),t.getMap().panTo({alt:2e3,lat:e.latitude/36e5,lng:e.longitude/36e5},{animate:!0})}})),this.vehicleLocationSubject.pipe(Object(P.a)((function(t){return null!==t})),Object(v.a)(),Object(E.a)((function(e){return t.apiService.getRouteByTripId(e.vehicle.tripId)}))).subscribe(new y.a((function(e){t.routeDisplayHandler.setRoutePaths(e.paths)})))},e.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this.updateObservable.unsubscribe()},e}(M.a)).ngDirectiveDef=c.Qb({type:a,selectors:[["map","appTripPassages",""]],factory:function(t){return new(t||a)(c.Vb(c.q),c.Vb(R.a),c.Vb(c.K),c.Vb(T.a),c.Vb(I.a))},inputs:{location:"location"},features:[c.Fb]}),a),L=r("tyNb"),x=r("Cfvw"),N=r("Kj3r"),k=r("JIr8"),A=r("A3oB"),C=r("j14s"),Z=[3,"blur","title"],V=["appTripPassages","","role","none",3,"location"],U=["class","error-box","aria-errormessage","Error retrieving data",4,"ngIf"],H=["role","list",4,"ngIf"],F=[1,"error-box",6,"aria-errormessage"],G=["aria-errormessage",c.jc("Error retrieving data")],Q=[1,"title"];o=c.jc("An error occured (Code: {$interpolation})",{interpolation:"\ufffd0\ufffd"});var B=[1,"text"],J=["appCountdownTimer","",3,"targetTime","placeholder"];function K(t,e){if(1&t&&(c.bc(0,"div",F),c.hc(1,G),c.bc(2,"span",Q),c.fc(3,o),c.Zb(),c.bc(4,"span",B),c.Qc(5,"Retrying in"),c.bc(6,"span",J),c.Qc(7,"test"),c.Zb(),c.Zb(),c.Zb()),2&t){var r=c.rc();c.Hc(3),c.ic(r.statusCode),c.gc(3),c.Hc(6),c.wc("targetTime",r.lastTimestamp+r.DEBOUNCE_TIME)("placeholder",'<i class="material-icons">sync</i>')}}var z=["role","list"],W=["role","listitem",3,"routerLink",4,"ngFor","ngForOf"],X=["role","listitem",3,"routerLink"],q=["matListIcon","","role","figure",6,"aria-label"],Y=["aria-label",c.jc("Bus stop icon")],$=["matLine","",6,"aria-label"],tt=["aria-label",c.jc("Stop name")],et=["matLine",""],rt=["role","timer"],nt=["role","status",1,"demo-2"],it=function(t){return["/stop",t]};function at(t,e){if(1&t&&(c.bc(0,"a",X),c.bc(1,"mat-list-item"),c.bc(2,"mat-icon",q),c.hc(3,Y),c.Qc(4,"trip_origin"),c.Zb(),c.bc(5,"h3",$),c.hc(6,tt),c.Qc(7),c.Zb(),c.bc(8,"p",et),c.bc(9,"span",rt),c.Qc(10),c.Zb(),c.bc(11,"span",nt),c.Qc(12),c.Zb(),c.Zb(),c.Zb(),c.Zb()),2&t){var r=e.$implicit;c.wc("routerLink",c.Ac(4,it,null==r?null:null==r.stop?null:r.stop.shortName)),c.Hc(7),c.Rc(null==r?null:null==r.stop?null:r.stop.name),c.Hc(10),c.Rc(null==r?null:r.actualTime),c.Hc(12),c.Sc("-- ",null==r?null:r.status,"")}}function ot(t,e){if(1&t&&(c.bc(0,"mat-nav-list",z),c.Pc(1,at,13,6,"a",W),c.Zb()),2&t){var r=c.rc();c.Hc(1),c.wc("ngForOf",r.tripPassages)}}var st,ct,ut,pt=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({}),lt=((st=function(){function t(t,e,r){var n=this;this.route=t,this.apiService=e,this.router=r,this.DEBOUNCE_TIME=5e3,this.STATUS_OPS=pt,this.status=new d.a(void 0),this.snapshotDataSubscription=this.route.data.subscribe((function(t){n.status.next({passages:t.tripPassages,status:pt.LOADED,timestamp:Date.now()})}))}return Object.defineProperty(t.prototype,"tripData",{get:function(){if(this.status.value)return this.status.value.passages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastTimestamp",{get:function(){return this.status.value?this.status.value.timestamp:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"statusCode",{get:function(){return this.status.value?this.status.value.status:pt.LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tripId",{get:function(){return this.route.snapshot.params.tripId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"routeName",{get:function(){return this.tripData?this.tripData.routeName:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tripPassages",{get:function(){return void 0!==this.tripData?this.tripData.actual:[]},enumerable:!0,configurable:!0}),t.prototype.hasError=function(){return this.statusCode>=pt.ERROR},t.prototype.ngAfterViewInit=function(){var t=this;this.pollSubscription=this.status.pipe(Object(N.a)(this.DEBOUNCE_TIME),Object(O.a)((function(){return t.route.snapshot.params.tripId})),Object(E.a)((function(e){return t.apiService.getTripPassages(e)})),Object(O.a)((function(t){return{passages:t,status:pt.LOADED,timestamp:Date.now()}})),Object(k.a)(this.handleError.bind(this))).subscribe(new y.a((function(e){t.status.next(e.passages.tripId===t.tripId?e:t.status.value)})))},t.prototype.ngOnDestroy=function(){this.snapshotDataSubscription&&this.snapshotDataSubscription.unsubscribe(),this.pollSubscription&&this.pollSubscription.unsubscribe()},t.prototype.handleError=function(t){var e=pt.ERROR;if(t.status){var r=t.status;404===r?(e=pt.NOT_FOUND,this.router.navigate(["not-found"],{queryParams:{type:"passages"}})):r>=500&&r<600&&(e=pt.SERVER_ERROR)}var n=Object.assign({},this.status.value);return n.status=e,n.failures?n.failures+=1:n.failures=1,Object(x.a)([n])},t}()).ngComponentDef=c.Pb({type:st,selectors:[["app-trip-passages"]],factory:function(t){return new(t||st)(c.Vb(L.a),c.Vb(T.a),c.Vb(L.f))},consts:4,vars:6,template:function(t,e){1&t&&(c.bc(0,"app-map-header-box",Z),c.Wb(1,"map",V),c.Zb(),c.Pc(2,K,8,3,"div",U),c.Pc(3,ot,2,1,"mat-nav-list",H)),2&t&&(c.zc("title","",e.routeName," - ",null==e.tripData?null:e.tripData.directionText,""),c.wc("blur",e.hasError()),c.Hc(1),c.wc("location",null==e.tripData?null:e.tripData.location),c.Hc(2),c.wc("ngIf",e.hasError()),c.Hc(3),c.wc("ngIf",e.tripId==(null==e.tripData?null:e.tripData.tripId)))},directives:[A.a,_,s.k,D,p.f,s.j,L.h,p.c,u.a,p.b,C.f],styles:["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]}),st),bt=r("EY2u"),ft=r("UsLG"),ht=((ct=function(){function t(t,e){this.api=t,this.router=e}return t.prototype.resolve=function(t,e){var r=this;return this.api.getTripPassages(t.params.tripId).pipe(Object(k.a)((function(t){return 404===t.status&&r.router.navigate(["error","not-found"],{queryParams:{type:ft.a.PASSAGE_NOT_FOUND}}),bt.a})))},t}()).ngInjectableDef=c.Rb({token:ct,factory:function(t){return new(t||ct)(c.kc(T.a),c.kc(L.f))},providedIn:null}),ct),dt=[{component:lt,data:{openSidebar:!0},path:":tripId",resolve:{tripPassages:ht}}],gt=((ut=function(){}).ngModuleDef=c.Tb({type:ut}),ut.ngInjectorDef=c.Sb({factory:function(t){return new(t||ut)},imports:[[L.i.forChild(dt)],L.i]}),ut);L.i.forChild(dt),r.d(e,"TripPassagesModule",(function(){return yt}));var mt,yt=((mt=function(){}).ngModuleDef=c.Tb({type:mt}),mt.ngInjectorDef=c.Sb({factory:function(t){return new(t||mt)},providers:[ht],imports:[[s.c,u.b,p.d,l.b,b.b,f.a,gt,h.a,j]]}),mt)}}]);